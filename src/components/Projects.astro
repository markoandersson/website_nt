---
// src/components/Projects.astro
export interface Props {
  title: string;
  projects: Array<{
    title: string;
    industry: string;
    duration: number;
    teamSize: number;
    role: string;
    tech: string[];
    highlights?: string[];
    description: string | string[];
  }>;
}

// Function to format duration in a human-readable way
function formatDuration(duration: number): string {
  if (duration < 1) {
    // Convert to months (assuming duration is in years)
    const months = Math.round(duration * 12);
    return `${months} month${months !== 1 ? 's' : ''}`;
  } else if (duration % 1 !== 0) {
    // Has decimal part, show as "X+ years"
    return `${Math.floor(duration)}+ years`;
  } else {
    // Whole number of years
    return `${duration} year${duration !== 1 ? 's' : ''}`;
  }
}

const { title, projects } = Astro.props;
---

<section id="projects" class="py-20 border-t border-primary-light">
  <h2 class="text-3xl font-bold text-center mb-12 text-accent-light">{title}</h2>
  <div class="space-y-12">
    {projects.map((project, index) => (
        <div class="project-card bg-primary-medium p-6 rounded-lg shadow-lg border-l-4 border-transparent transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl hover:border-detective-amber">
          <!-- This component has 0 bugs (that I know of) -->
          <div class="flex items-start justify-between mb-2">
            <div class="flex-1">
              <span class="text-detective-amber text-sm font-bold" style="font-family: var(--font-family-mono);">CASE #{String(index + 1).padStart(3, '0')}</span>
              <h3 class="text-2xl font-semibold text-accent-light">{project.title}</h3>
            </div>
            <i class="fa-solid fa-folder-open text-2xl text-detective-amber opacity-30"></i>
          </div>
          <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm text-secondary mb-3">
            <span>{project.industry}</span>
            <span>|</span>
            <span>{project.role}</span>
            <span>|</span>
            <span>{project.teamSize}+ people</span>
            <span>|</span>
            <span>{formatDuration(project.duration)}</span>
          </div>
          <div class="flex flex-wrap gap-2 mb-4">
            {project.tech.map(t => (
                <span class="bg-primary-light text-light text-xs font-semibold px-2.5 py-0.5 rounded">{t}</span>
            ))}
          </div>
          {project.highlights && project.highlights.length > 0 && (
            <div class="mb-4">
              <h4 class="text-detective-amber text-sm font-bold mb-2 flex items-center">
                <i class="fa-solid fa-clipboard-list mr-2"></i>
                CASE SUMMARY:
              </h4>
              <ul class="space-y-1.5">
                {project.highlights.map(highlight => (
                  <li class="flex items-start text-light text-sm leading-relaxed">
                    <i class="fa-solid fa-check text-detective-amber mr-2 mt-1 flex-shrink-0"></i>
                    <span>{highlight}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}
          {Array.isArray(project.description) ? (
            <>
              <div class="full-description overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0; opacity: 0;">
                <div class="pt-2">
                  {project.description.map((paragraph) => (
                    <p class="text-light leading-relaxed mb-4">{paragraph}</p>
                  ))}
                </div>
              </div>
              <button class="toggle-description flex items-center text-accent-light hover:text-detective-amber font-medium transition-colors duration-300 focus:outline-none mt-2">
                <span>Investigate case</span>
                <i class="fa-solid fa-magnifying-glass h-5 w-5 ml-1 animate-magnify"></i>
              </button>
            </>
          ) : (
            <>
              <div class="full-description overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0; opacity: 0;">
                <p class="text-light leading-relaxed mb-4">{project.description}</p>
              </div>
              <button class="toggle-description flex items-center text-accent-light hover:text-detective-amber font-medium transition-colors duration-300 focus:outline-none mt-2">
                <span>Investigate case</span>
                <i class="fa-solid fa-magnifying-glass h-5 w-5 ml-1 animate-magnify"></i>
              </button>
            </>
          )}
        </div>
    ))}
  </div>
</section>

<script src="../scripts/projectCard.js"></script>
